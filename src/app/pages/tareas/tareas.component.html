<!-- src/app/components/tareas/tareas.component.html -->
<div class="tareas-container">
  
  <!-- Header -->
  <div class="header">
    <div class="titulo-seccion">
      <h1>ğŸ“‹ Tareas WhatsApp</h1>
      <div class="estado-bot" [ngClass]="estadoBot">
        <span class="dot"></span>
        Bot: {{ estadoBot }}
      </div>
    </div>

    <!-- EstadÃ­sticas -->
    <div class="estadisticas" *ngIf="estadisticas">
      <div class="stat-card">
        <div class="stat-numero">{{ estadisticas.total }}</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card pendientes">
        <div class="stat-numero">{{ estadisticas.pendientes }}</div>
        <div class="stat-label">Pendientes</div>
      </div>
      <div class="stat-card progreso">
        <div class="stat-numero">{{ estadisticas.enProgreso }}</div>
        <div class="stat-label">En Progreso</div>
      </div>
      <div class="stat-card completadas">
        <div class="stat-numero">{{ estadisticas.completadas }}</div>
        <div class="stat-label">Completadas</div>
      </div>
    </div>
  </div>

  <!-- Controles -->
  <div class="controles">
    <div class="filtros">
      <input 
        type="text" 
        [(ngModel)]="busqueda" 
        (ngModelChange)="aplicarFiltros()"
        placeholder="ğŸ” Buscar..."
        class="input-busqueda">

      <select [(ngModel)]="filtroEstado" (ngModelChange)="aplicarFiltros()" class="filtro-select">
        <option value="todos">Todos los estados</option>
        <option value="pendiente">â³ Pendientes</option>
        <option value="en_progreso">ğŸ”„ En Progreso</option>
        <option value="completada">âœ… Completadas</option>
      </select>

      <select [(ngModel)]="filtroPrioridad" (ngModelChange)="aplicarFiltros()" class="filtro-select">
        <option value="todos">Todas las prioridades</option>
        <option value="alta">ğŸ”¥ Alta</option>
        <option value="media">âš¡ Media</option>
        <option value="baja">ğŸ“Œ Baja</option>
      </select>

      <select [(ngModel)]="filtroCategoria" (ngModelChange)="aplicarFiltros()" class="filtro-select">
        <option value="todos">Todas las categorÃ­as</option>
        <option value="general">ğŸ“‹ General</option>
        <option value="soporte-tecnico">ğŸ”§ Soporte</option>
        <option value="reunion">ğŸ“… ReuniÃ³n</option>
        <option value="diseÃ±o">ğŸ¨ DiseÃ±o</option>
        <option value="documentacion">ğŸ“„ Docs</option>
        <option value="atencion-cliente">ğŸ‘¥ Cliente</option>
      </select>
    </div>

    <div class="acciones">
      <button (click)="cargarTareas()" class="btn btn-refresh" [disabled]="cargando">
        ğŸ”„ {{ cargando ? 'Cargando...' : 'Actualizar' }}
      </button>
      
      <button (click)="toggleAutoActualizar()" 
              [class.activo]="autoActualizar" 
              class="btn btn-auto">
        {{ autoActualizar ? 'â¸ï¸ Pausar' : 'â–¶ï¸ Reanudar' }}
      </button>

      <div class="vista-selector">
        <button (click)="cambiarVista('tarjetas')" 
                [class.activo]="vistaActual === 'tarjetas'"
                class="btn btn-vista">ğŸƒ</button>
        <button (click)="cambiarVista('lista')" 
                [class.activo]="vistaActual === 'lista'"
                class="btn btn-vista">ğŸ“‹</button>
        <button (click)="cambiarVista('kanban')" 
                [class.activo]="vistaActual === 'kanban'"
                class="btn btn-vista">ğŸ“Š</button>
      </div>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="cargando" class="loader">
    <div class="spinner"></div>
    <p>Cargando tareas...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error-message">
    âŒ {{ error }}
    <button (click)="cargarTareas()" class="btn-retry">Reintentar</button>
  </div>

  <!-- Sin tareas -->
  <div *ngIf="!cargando && !error && tareasFiltradas.length === 0" class="sin-tareas">
    <span class="empty-icon">ğŸ“­</span>
    <h3>No hay tareas</h3>
    <p>{{ busqueda ? 'No se encontraron resultados' : 'Esperando mensajes de WhatsApp...' }}</p>
  </div>

  <!-- VISTA TARJETAS -->
  <div *ngIf="!cargando && !error && vistaActual === 'tarjetas'" class="tareas-grid">
    <div *ngFor="let tarea of tareasFiltradas" class="tarea-card" [attr.data-prioridad]="tarea.prioridad">
      
      <div class="card-header">
        <div class="card-badges">
          <span class="badge badge-prioridad" [attr.data-prioridad]="tarea.prioridad">
            {{ getEmojiPrioridad(tarea.prioridad) }}
          </span>
          <span class="badge badge-categoria">
            {{ getIconoCategoria(tarea.categoria) }}
          </span>
        </div>
        <span class="card-id">#{{ tarea.id }}</span>
      </div>

      <div class="card-body">
        <h3 class="card-titulo">{{ tarea.titulo }}</h3>
        <p class="card-descripcion">{{ tarea.descripcion }}</p>
        
        <div class="card-info">
          <div class="info-item">
            <span class="info-icon">ğŸ‘¤</span>
            <span>{{ tarea.remitente }}</span>
          </div>
          <div class="info-item">
            <span class="info-icon">â°</span>
            <span>{{ formatearFecha(tarea.fecha) }}</span>
          </div>
          <div class="info-item" *ngIf="tarea.menciones && tarea.menciones.length > 0">
            <span class="info-icon">ğŸ‘¥</span>
            <span>{{ '@' }}{{ tarea.menciones.join(', @') }}</span>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <select [(ngModel)]="tarea.estado" 
                (ngModelChange)="cambiarEstadoTarea(tarea, $event)"
                class="estado-select"
                [attr.data-estado]="tarea.estado">
          <option value="pendiente">â³ Pendiente</option>
          <option value="en_progreso">ğŸ”„ En Progreso</option>
          <option value="completada">âœ… Completada</option>
        </select>

        <div class="card-acciones">
          <button (click)="completarTarea(tarea)" 
                  *ngIf="tarea.estado !== 'completada'"
                  class="btn-icon" 
                  title="Completar">âœ…</button>
          <button (click)="eliminarTarea(tarea)" 
                  class="btn-icon btn-danger" 
                  title="Eliminar">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>
  </div>

  <!-- VISTA LISTA -->
  <div *ngIf="!cargando && !error && vistaActual === 'lista'" class="tareas-lista">
    <table class="tabla-tareas">
      <thead>
        <tr>
          <th>ID</th>
          <th>TÃ­tulo</th>
          <th>De</th>
          <th>Prioridad</th>
          <th>CategorÃ­a</th>
          <th>Estado</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tarea of tareasFiltradas">
          <td class="td-id">#{{ tarea.id }}</td>
          <td class="td-titulo">
            <strong>{{ tarea.titulo }}</strong>
            <small *ngIf="tarea.menciones && tarea.menciones.length">
              {{ '@' }}{{ tarea.menciones.join(' @') }}
            </small>
          </td>
          <td>{{ tarea.remitente }}</td>
          <td>
            <span class="badge badge-prioridad" [attr.data-prioridad]="tarea.prioridad">
              {{ getEmojiPrioridad(tarea.prioridad) }}
            </span>
          </td>
          <td>
            <span class="badge badge-categoria">
              {{ getIconoCategoria(tarea.categoria) }}
            </span>
          </td>
          <td>
            <select [(ngModel)]="tarea.estado" 
                    (ngModelChange)="cambiarEstadoTarea(tarea, $event)"
                    class="estado-select-small"
                    [attr.data-estado]="tarea.estado">
              <option value="pendiente">â³</option>
              <option value="en_progreso">ğŸ”„</option>
              <option value="completada">âœ…</option>
            </select>
          </td>
          <td class="td-fecha">{{ formatearFecha(tarea.fecha) }}</td>
          <td class="td-acciones">
            <button (click)="completarTarea(tarea)" 
                    *ngIf="tarea.estado !== 'completada'"
                    class="btn-icon-small">âœ…</button>
            <button (click)="eliminarTarea(tarea)" 
                    class="btn-icon-small btn-danger">ğŸ—‘ï¸</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- VISTA KANBAN -->
  <div *ngIf="!cargando && !error && vistaActual === 'kanban'" class="kanban-board">
    
    <!-- Columna Pendientes -->
    <div class="kanban-column">
      <div class="column-header pendiente">
        <h3>â³ Pendientes</h3>
        <span class="count">{{ getTareasPorEstado('pendiente').length }}</span>
      </div>
      <div class="column-body">
        <div *ngFor="let tarea of getTareasPorEstado('pendiente')" 
             class="kanban-card" 
             [attr.data-prioridad]="tarea.prioridad">
          <div class="kanban-header">
            <span class="badge" [attr.data-prioridad]="tarea.prioridad">
              {{ getEmojiPrioridad(tarea.prioridad) }}
            </span>
            <span class="badge">{{ getIconoCategoria(tarea.categoria) }}</span>
          </div>
          <h4>{{ tarea.titulo }}</h4>
          <p>{{ tarea.descripcion.substring(0, 100) }}...</p>
          <div class="kanban-footer">
            <small>ğŸ‘¤ {{ tarea.remitente }}</small>
            <div class="kanban-acciones">
              <button (click)="cambiarEstadoTarea(tarea, 'en_progreso')" class="btn-mini">â–¶ï¸</button>
              <button (click)="eliminarTarea(tarea)" class="btn-mini btn-danger">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna En Progreso -->
    <div class="kanban-column">
      <div class="column-header progreso">
        <h3>ğŸ”„ En Progreso</h3>
        <span class="count">{{ getTareasPorEstado('en_progreso').length }}</span>
      </div>
      <div class="column-body">
        <div *ngFor="let tarea of getTareasPorEstado('en_progreso')" 
             class="kanban-card">
          <div class="kanban-header">
            <span class="badge" [attr.data-prioridad]="tarea.prioridad">
              {{ getEmojiPrioridad(tarea.prioridad) }}
            </span>
            <span class="badge">{{ getIconoCategoria(tarea.categoria) }}</span>
          </div>
          <h4>{{ tarea.titulo }}</h4>
          <p>{{ tarea.descripcion.substring(0, 100) }}...</p>
          <div class="kanban-footer">
            <small>ğŸ‘¤ {{ tarea.remitente }}</small>
            <div class="kanban-acciones">
              <button (click)="completarTarea(tarea)" class="btn-mini">âœ…</button>
              <button (click)="cambiarEstadoTarea(tarea, 'pendiente')" class="btn-mini">âª</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna Completadas -->
    <div class="kanban-column">
      <div class="column-header completada">
        <h3>âœ… Completadas</h3>
        <span class="count">{{ getTareasPorEstado('completada').length }}</span>
      </div>
      <div class="column-body">
        <div *ngFor="let tarea of getTareasPorEstado('completada')" 
             class="kanban-card completada">
          <div class="kanban-header">
            <span class="badge">{{ getIconoCategoria(tarea.categoria) }}</span>
          </div>
          <h4>{{ tarea.titulo }}</h4>
          <p>{{ tarea.descripcion.substring(0, 80) }}...</p>
          <div class="kanban-footer">
            <small>âœ… {{ formatearFecha(tarea.fechaCompletada || tarea.fecha) }}</small>
            <button (click)="eliminarTarea(tarea)" class="btn-mini btn-danger">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>