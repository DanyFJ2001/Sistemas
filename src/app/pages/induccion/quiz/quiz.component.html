<div class="quiz-wrapper" [class.animate-in]="animateIn">
  <div class="quiz-topbar">
    <button class="back-btn" (click)="goBack()">‚Üê Volver al contenido</button>
    <div class="quiz-progress-info">{{ answeredCount }} / {{ totalQuestions }} respondidas</div>
  </div>

  <div class="quiz-progress-bar">
    <div class="quiz-progress-fill" [style.width.%]="progressPercent"></div>
  </div>

  <!-- RESULTS -->
  <div *ngIf="showResults" class="results-container">
    <div class="results-card" [ngClass]="getScoreClass()">
      <div class="results-content">
        <div class="score-circle">
          <svg viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
            <circle cx="60" cy="60" r="54" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round"
                    stroke-dasharray="339.292" [attr.stroke-dashoffset]="getStrokeDashoffset()" transform="rotate(-90 60 60)" class="score-ring"/>
          </svg>
          <div class="score-text">
            <span class="score-num">{{ score }}</span>
            <span class="score-den">/ {{ totalQuestions }}</span>
          </div>
        </div>
        <h2>{{ getScoreMessage() }}</h2>
        <p class="score-percentage">{{ ((score / totalQuestions) * 100).toFixed(0) }}% de aciertos</p>
        <div class="results-actions">
          <button class="btn-primary" (click)="resetQuiz()">üîÑ Intentar de nuevo</button>
          <button class="btn-secondary" (click)="goBack()">üìñ Volver al contenido</button>
        </div>
      </div>
    </div>

    <div class="review-section">
      <h3 class="review-title">Revisi√≥n detallada</h3>
      <div *ngFor="let q of questions; let i = index" class="review-item">
        <div class="review-header">
          <span class="review-number">{{ i + 1 }}</span>
          <span class="review-status" [class.correct]="q.selectedIndex !== null && q.options[q.selectedIndex!].isCorrect" [class.incorrect]="q.selectedIndex !== null && !q.options[q.selectedIndex!].isCorrect">
            {{ q.selectedIndex !== null && q.options[q.selectedIndex!].isCorrect ? '‚úì Correcto' : '‚úó Incorrecto' }}
          </span>
        </div>
        <p class="review-question">{{ q.question }}</p>
        <div class="review-options">
          <div *ngFor="let opt of q.options; let oi = index" class="review-option" [class.selected]="q.selectedIndex === oi" [class.is-correct]="opt.isCorrect" [class.is-wrong]="q.selectedIndex === oi && !opt.isCorrect">
            <span class="review-letter">{{ getOptionLetter(oi) }}</span>
            <span>{{ opt.text }}</span>
            <span *ngIf="opt.isCorrect" class="correct-badge">‚úì</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div *ngIf="!showResults" class="quiz-container">
    <div class="quiz-header">
      <div class="quiz-badge">EVALUACI√ìN</div>
      <h1>Banco de Preguntas</h1>
      <p>√Årea de Sistemas ‚Äî Inducci√≥n Corporativa</p>
    </div>

    <div class="quiz-body">
      <div class="page-indicator">P√°gina {{ currentPage + 1 }} de {{ totalPages }}</div>

      <div *ngFor="let q of currentQuestions; let qi = index" class="question-card" [style.animationDelay]="(qi * 80) + 'ms'">
        <div class="question-header">
          <span class="question-number">{{ q.id }}</span>
          <span class="question-text">{{ q.question }}</span>
        </div>
        <div class="options-list">
          <div *ngFor="let opt of q.options; let oi = index" class="option-item"
               [class.selected]="q.selectedIndex === oi"
               [class.correct]="quizSubmitted && opt.isCorrect"
               [class.wrong]="quizSubmitted && q.selectedIndex === oi && !opt.isCorrect"
               (click)="selectOption(q, oi)">
            <span class="option-letter">{{ getOptionLetter(oi) }}</span>
            <span class="option-text">{{ opt.text }}</span>
            <span class="option-check" *ngIf="q.selectedIndex === oi">‚óè</span>
          </div>
        </div>
      </div>

      <div class="quiz-nav">
        <button class="nav-btn" (click)="prevPage()" [disabled]="currentPage === 0">‚Üê Anterior</button>
        <div class="page-dots">
          <span *ngFor="let p of pageArray; let pi = index" class="page-dot" [class.active]="pi === currentPage" (click)="currentPage = pi"></span>
        </div>
        <button *ngIf="currentPage < totalPages - 1" class="nav-btn" (click)="nextPage()">Siguiente ‚Üí</button>
        <button *ngIf="currentPage === totalPages - 1" class="nav-btn submit-btn" [disabled]="!allAnswered" (click)="submitQuiz()">üìù Enviar Evaluaci√≥n</button>
      </div>

      <p *ngIf="currentPage === totalPages - 1 && !allAnswered" class="warning-text">‚ö†Ô∏è Debes responder todas las preguntas antes de enviar.</p>
    </div>
  </div>
</div>